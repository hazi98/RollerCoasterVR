<!DOCTYPE html>
<html lang="en">

<head>
    <title>Personal Info - Magic Sans</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Magic Sans Theme Park">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- CSS -->
    <link href="styles/bootstrap4/bootstrap.min.css" rel="stylesheet" type="text/css" rel="preload" as="style">
    <link href="plugins/fontawesome-free-5.13.0-web/css/fontawesome.min.css" rel="stylesheet" type="text/css"
        rel="preload" as="style">
    <link href="plugins/fontawesome-free-5.13.0-web/css/brands.min.css" rel="stylesheet" type="text/css" rel="preload"
        as="style">
    <link href="plugins/fontawesome-free-5.13.0-web/css/solid.min.css" rel="stylesheet" type="text/css" rel="preload"
        as="style">
    <link href="styles/elements_styles.min.css" rel="stylesheet" type="text/css" rel="preload" as="style">
    <link href="styles/elements_responsive.css" rel="stylesheet" type="text/css" rel="preload" as="style">
    <link href="styles/cookies.css" rel="stylesheet" type="text/css" rel="preload" as="style">
    <link href="plugins/intl-tel-input/css/intlTelInput.min.css" rel="stylesheet" type="text/css" rel="preload"
        as="style">
    <!-- Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="./apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./favicon-16x16.png">
    <link rel="manifest" href="./site.webmanifest">
    <link rel="mask-icon" href="./safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
    <script src="js/jquery-3.5.1.min.js"></script>
    <script>
        $.ajax({
            method: "POST",
            url: 'php/redirect.php',
            async: false,
        }).done(function (data) {
            if (!data) {
                window.location = 'login.html';
            }
        });
    </script>
</head>

<body>

    <div class="super_container">

        <!-- Header -->

        <header class="header">

            <!-- Top Bar -->

            <div class="top_bar">
                <div class="container">
                    <div class="row">
                        <div class="col d-flex flex-row">
                            <div class="phone">(55) 1234 5678</div>
                            <div class="social">
                                <ul class="social_list">
                                    <li class="social_list_item"><a href="#"><i class="fab fa-youtube"
                                                aria-hidden="true"></i> YouTube</a></li>
                                    <li class="social_list_item"><a href="#"><i class="fab fa-facebook"
                                                aria-hidden="true"></i> Facebook</a></li>
                                    <li class="social_list_item"><a href="#"><i class="fab fa-twitter"
                                                aria-hidden="true"></i> Twitter</a></li>
                                </ul>
                            </div>
                            <div class="user_box ml-auto" id="session_box">
                                <div class="user_box_login user_box_link" id="login-box"><a href="login.html">login</a>
                                </div>
                                <div class="user_box_register user_box_link" id="register-box"><a
                                        href="register.html">register</a></div>
                                <div class="user_box_login user_box_link" id="wb-box" style="display: none;"><a
                                        id="user-back">welcome
                                        back </a></div>
                                <div class="user_box_login user_box_link" id="account-box" style="display: none;"><a
                                        href="account.html">account</a></div>
                                <div class="user_box_register user_box_link" id="logout-box" style="display: none;"><a
                                        href="php/logout.php">logout</a></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Navigation -->

            <nav class="main_nav">
                <div class="container">
                    <div class="row">
                        <div class="col main_nav_col d-flex flex-row align-items-center justify-content-start">
                            <div class="logo_container">
                                <div class="logo"><a href="index.html"><img src="images/amusement-park.png" width="40px"
                                            alt="">Magic Sans</a>
                                </div>
                            </div>

                            <div class="main_nav_container ml-auto">
                                <ul class="main_nav_list">
                                    <li class="main_nav_item"><a href="index.html">home</a></li>
                                    <li class="main_nav_item"><a href="#">about us</a></li>
                                    <li class="main_nav_item"><a href="#">offers</a></li>
                                    <li class="main_nav_item"><a href="#">news</a></li>
                                    <li class="main_nav_item"><a href="#">contact</a></li>
                                </ul>
                            </div>
                            <div class="content_search ml-lg-0 ml-auto">
                                <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg"
                                    xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="17px"
                                    height="17px" viewBox="0 0 512 512" enable-background="new 0 0 512 512"
                                    xml:space="preserve">
                                    <g>
                                        <g>
                                            <g>
                                                <path class="mag_glass" fill="#FFFFFF" d="M78.438,216.78c0,57.906,22.55,112.343,63.493,153.287c40.945,40.944,95.383,63.494,153.287,63.494
											s112.344-22.55,153.287-63.494C489.451,329.123,512,274.686,512,216.78c0-57.904-22.549-112.342-63.494-153.286
											C407.563,22.549,353.124,0,295.219,0c-57.904,0-112.342,22.549-153.287,63.494C100.988,104.438,78.439,158.876,78.438,216.78z
											M119.804,216.78c0-96.725,78.69-175.416,175.415-175.416s175.418,78.691,175.418,175.416
											c0,96.725-78.691,175.416-175.416,175.416C198.495,392.195,119.804,313.505,119.804,216.78z" />
                                            </g>
                                        </g>
                                        <g>
                                            <g>
                                                <path class="mag_glass" fill="#FFFFFF" d="M6.057,505.942c4.038,4.039,9.332,6.058,14.625,6.058s10.587-2.019,14.625-6.058L171.268,369.98
											c8.076-8.076,8.076-21.172,0-29.248c-8.076-8.078-21.172-8.078-29.249,0L6.057,476.693
											C-2.019,484.77-2.019,497.865,6.057,505.942z" />
                                            </g>
                                        </g>
                                    </g>
                                </svg>
                            </div>

                            <form id="search_form" class="search_form bez_1">
                                <input type="search" class="search_content_input bez_1">
                            </form>

                            <div class="hamburger">
                                <i class="fa fa-bars trans_200"></i>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <nav class="col" aria-label="breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="index.html"><i class="fas fa-home"></i> Home</a>
                                </li>
                                <li class="breadcrumb-item"><a href="account.html"><i class="fas fa-user-circle"
                                            aria-hidden="true"></i> Account</a></li>
                                <li class="breadcrumb-item active" aria-current="page">Personal information</li>
                            </ol>
                        </nav>
                    </div>
                </div>
            </nav>

        </header>

        <div class="menu trans_500">
            <div class="menu_content d-flex flex-column align-items-center justify-content-center text-center">
                <div class="menu_close_container">
                    <div class="menu_close"></div>
                </div>
                <div class="logo menu_logo"><a href="#"><img src="images/amusement-park.png" width="40px" alt=""></a>
                </div>
                <ul>
                    <li class="menu_item"><a href="index.html">home</a></li>
                    <li class="menu_item"><a href="#">about us</a></li>
                    <li class="menu_item"><a href="#">offers</a></li>
                    <li class="menu_item"><a href="#">news</a></li>
                    <li class="menu_item"><a href="#">contact</a></li>
                </ul>
            </div>
        </div>

        <!-- Toasts -->
        <div aria-live="polite" aria-atomic="true" style="min-height: 250px; z-index: 100; position: absolute">
            <!-- Position it -->
            <div style="min-width: 250px; position: fixed;bottom: 0;right: 0;margin-right: 10vw;margin-bottom: 10vh;">
                <!-- Then put toasts within -->
                <div class="toast fade" role="alert" aria-live="assertive" aria-atomic="true" id="notification-toast"
                    data-delay="3000">
                    <div class="toast-header">
                        <img src="images/webp/amusement-park.webp" class="rounded mr-2" alt="logo" width="15px" />
                        <strong class="mr-auto" id="toast-title">Notification</strong>
                        <small class="text-muted">notification</small>
                        <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="toast-body" id="toast-body">
                        See? Just like this.
                    </div>
                </div>
            </div>
        </div>

        <!-- Account -->

        <div class="elements-flex">
            <div class="container">

                <div class="row">
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col elements_title">Personal Information
                            </div>
                        </div>
                        <form class="card mt-3" id="account-details">
                            <div class="card-body">
                                <div class="form-group">
                                    <label for="username">Username</label>
                                    <input type="text" name="username" id="username" class="form-control" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="email">E-Mail</label>
                                    <input type="email" name="email" id="email" class="form-control" readonly>
                                    <div class="form-text text-muted">
                                        We use your email to send you notifications and to recover your account.
                                    </div>
                                </div>
                                <div class="button button_color_2 trans_200">
                                    <a href="change-password.html"><i class="fa fa-key" aria-hidden="true"></i> change
                                        password</a>
                                </div>
                                <hr>
                                <div class="form-group">
                                    <label for="name">Name</label>
                                    <div class="row" id="name">
                                        <div class="col-md-4">
                                            <input type="text" name="first-name" class="form-control"
                                                placeholder="First Name" required>
                                        </div>
                                        <div class="col-md-4">
                                            <input type="text" name="middle-name" class="form-control"
                                                placeholder="Middle Name">
                                        </div>
                                        <div class="col-md-4">
                                            <input type="text" name="last-name" class="form-control"
                                                placeholder="Last Name" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="age">Age</label>
                                    <input type="number" name="age" class="form-control" min="1">
                                </div>
                                <div class="form-group">
                                    <label for="gender">Gender</label>
                                    <div class="custom-control custom-radio">
                                        <input type="radio" name="gender" id="gender1" class="custom-control-input"
                                            required value="male">
                                        <label for="gender1" class="custom-control-label">Male</label>
                                    </div>
                                    <div class="custom-control custom-radio">
                                        <input type="radio" name="gender" id="gender2" class="custom-control-input"
                                            value="female">
                                        <label for="gender2" class="custom-control-label">Female</label>
                                    </div>
                                    <div class="custom-control custom-radio">
                                        <input type="radio" name="gender" id="gender3" class="custom-control-input"
                                            value="other">
                                        <label for="gender3" class="custom-control-label">Other</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="phone">Phone Number</label>
                                    <input type="tel" id="phone" name="phone" class="form-control">
                                </div>
                                <button type="submit" class="button button_color_1 trans_200">
                                    <p>update information</p>
                                </button>
                            </div>
                        </form>
                    </div>
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col elements_title">Address Information
                            </div>
                        </div>
                        <form action="" class="card mt-3" id="address-information">
                            <div class="card-body">
                                <div class="form-group">
                                    <label for="address1">Address 1</label>
                                    <input type="text" name="address1" id="address1" class="form-control"
                                        maxlength="255">
                                </div>
                                <div class="form-group">
                                    <label for="address2">Address 2</label>
                                    <input type="text" name="address2" id="address2" class="form-control"
                                        maxlength="255">
                                </div>
                                <div class="form-group">
                                    <label for="country">Country</label>
                                    <select name="country" id="country" class="form-control">
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="city">City</label>
                                    <input type="text" name="city" id="city" class="form-control" maxlength="255">
                                </div>
                                <div class="form-group">
                                    <label for="state">State</label>
                                    <input type="text" name="state" id="state" class="form-control" maxlength="255">
                                </div>
                                <div class="form-group">
                                    <label for="zip">ZIP</label>
                                    <input type="text" name="zip" id="zip" class="form-control" minlength="2"
                                        maxlength="11">
                                </div>
                                <button type="submit" class="button button_color_1 trans_200">
                                    <p>update address</p>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->

        <footer class="footer">
            <div class="container">
                <div class="row">

                    <!-- Footer Column -->
                    <div class="col-lg-3 footer_column">
                        <div class="footer_col">
                            <div class="footer_content footer_about">
                                <div class="logo_container footer_logo">
                                    <div class="logo"><a href="#"><img src="images/amusement-park.png" width="40px"
                                                alt="">Magic
                                            Sans</a></div>
                                </div>
                                <p class="footer_about_text">Lorem ipsum dolor sit amet, consectetur adipiscing elit.
                                    Vivamus quis vu lputate eros, iaculis consequat nisl. Nunc et suscipit urna. Integer
                                    eleme ntum orci eu vehicula pretium.</p>
                                <ul class="footer_social_list">
                                    <li class="footer_social_item"><a href="#"><i class="fa fa-youtube-play"></i></a>
                                    </li>
                                    <li class="footer_social_item"><a href="#"><i class="fa fa-facebook-f"></i></a></li>
                                    <li class="footer_social_item"><a href="#"><i class="fa fa-twitter"></i></a></li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Footer Column -->
                    <div class="col-lg-3 footer_column">
                        <div class="footer_col">
                            <div class="footer_title">contact info</div>
                            <div class="footer_content footer_contact">
                                <ul class="contact_info_list">
                                    <li class="contact_info_item d-flex flex-row">
                                        <div>
                                            <div class="contact_info_icon"><img src="images/placeholder.svg" alt="">
                                            </div>
                                        </div>
                                        <div class="contact_info_text">Benjamin Hill 45, Condesa, CDMX</div>
                                    </li>
                                    <li class="contact_info_item d-flex flex-row">
                                        <div>
                                            <div class="contact_info_icon"><img src="images/phone-call.svg" alt="">
                                            </div>
                                        </div>
                                        <div class="contact_info_text">(55) 1234 5678</div>
                                    </li>
                                    <li class="contact_info_item d-flex flex-row">
                                        <div>
                                            <div class="contact_info_icon"><img src="images/message.svg" alt=""></div>
                                        </div>
                                        <div class="contact_info_text"><a
                                                href="mailto:contactme@gmail.com?Subject=Hello"
                                                target="_top">contact@magicsans.com</a></div>
                                    </li>
                                    <li class="contact_info_item d-flex flex-row">
                                        <div>
                                            <div class="contact_info_icon"><img src="images/planet-earth.svg" alt="">
                                            </div>
                                        </div>
                                        <div class="contact_info_text"><a
                                                href="https://colorlib.com">www.magicsans.com</a></div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </footer>

        <!-- Copyright -->

        <div class="copyright">
            <div class="container">
                <div class="row">
                    <div class="col-lg-3 order-lg-1 order-2  ">
                        <div class="copyright_content d-flex flex-row align-items-center">
                            <div>
                                Copyright &copy; 2020 - Magic Sans
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-9 order-lg-2 order-1">
                        <div class="footer_nav_container d-flex flex-row align-items-center justify-content-lg-end">
                            <div class="footer_nav">
                                <ul class="footer_nav_list">
                                    <li class="footer_nav_item"><a href="#">home</a></li>
                                    <li class="footer_nav_item"><a href="about.html">about us</a></li>
                                    <li class="footer_nav_item"><a href="offers.html">offers</a></li>
                                    <li class="footer_nav_item"><a href="privacy.html">privacy</a></li>
                                    <li class="footer_nav_item"><a href="contact.html">contact</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script src="styles/bootstrap4/popper.min.js"></script>
    <script src="styles/bootstrap4/bootstrap.min.js"></script>
    <script src="js/jquery.ihavecookies.min.js"></script>
    <script src="js/custom.min.js"></script>
    <script src="plugins/intl-tel-input/js/intlTelInput.min.js"></script>
    <script src="plugins/jquery.validate.min.js"></script>
    <script>
        // Cookies
        $('body').ihavecookies({
            title: "Cookies & Privacy",
            message: "This website uses cookies to ensure you get the best experience on our website.",
            link: "privacy.html"
        });
    </script>
    <script>
        $.ajax({
            method: "POST",
            url: 'php/redirect.php',
        }).done(function (data) {
            if (data === '1') {
                $('#login-box').hide();
                $('#register-box').hide();
                $('#wb-box').show();
                $('#account-box').show();
                $('#logout-box').show();
            }
        });
        var userinfo = "";
        if (localStorage.getItem('userinfo') === null) {
            $.get('php/getUserInfo.php', function (data) {
                localStorage.setItem('userinfo', data);
                userinfo = JSON.parse(localStorage.getItem('userinfo'));
            })
            updateLabels();

        } else {
            userinfo = JSON.parse(localStorage.getItem('userinfo'));
            updateLabels();
        }

        function updateLabels() {
            $('#email').val(userinfo.email);
            $('#username').val(userinfo.username);
            $('#user-back').append(userinfo.username);
        }


        function onEmailChange() {
            var email = $('#email').val()
            if (email != userinfo.email) {
                console.log('Email changed');
            }
        }
    </script>
    <script>
        var input = document.querySelector("#phone");
        var iti = window.intlTelInput(input, {
            // any initialisation options go here
            utilsScript: 'plugins/intl-tel-input/js/utils.js',
            initialCountry: "auto",
            separateDialCode: true,
            geoIpLookup: function (callback) {
                $.get('http://ip-api.com/json', function (resp) {
                    var countryCode = (resp && resp.countryCode) ? resp.countryCode : "";
                    callback(countryCode);
                })
            },
        });

        // populate the country dropdown
        var countryData = window.intlTelInputGlobals.getCountryData(),
            input = document.querySelector("#phone"),
            addressDropdown = document.querySelector("#country")

        for (var i = 0; i < countryData.length; i++) {
            var country = countryData[i];
            var optionNode = document.createElement("option");
            optionNode.value = country.iso2;
            var textNode = document.createTextNode(country.name);
            optionNode.appendChild(textNode);
            addressDropdown.appendChild(optionNode);
        }
        // set it's initial value
        addressDropdown.value = iti.getSelectedCountryData().iso2;

        // listen to the telephone input for changes
        input.addEventListener('countrychange', function (e) {
            addressDropdown.value = iti.getSelectedCountryData().iso2;
        });

        // listen to the address dropdown for changes
        addressDropdown.addEventListener('change', function () {
            iti.setCountry(this.value);
        });

        // GET Personal information
        $.get('php/getPersonalInfo.php', function (data) {
            populate('#account-details', JSON.parse(data));
        })

        // GET Address information
        $.get('php/getAddress.php', function (data) {
            populate('#address-information', JSON.parse(data));
        })
        // Validate forms
        $('#account-details').validate({
            rules: {
                'first-name': "required",
                "last-name": "required",
                "age": "required",
                "gender": "required"
            },
            messages: {
                "first-name": "Please enter your first name",
                "last-name": "Please enter your last name",
                "age": "Please enter your age",
                "gender": "Specify this option"
            },
            errorElement: "div",
            errorPlacement: function (error, element) {
                // Add the `help-block` class to the error element
                error.addClass("invalid-feedback");

                if (element.prop("type") === "checkbox") {
                    error.insertAfter(element.parent("label"));
                } else if (element.prop("type") === "radio") {
                    error.insertBefore(element.parent("label"));
                } else {
                    error.insertAfter(element);
                }
            },

        });

        $('#address-information').validate({
            rules: {
                'address1': "required",
                'country': "required",
                'city': "required",
                'state': "required",
                'zip': "required"
            },
            errorElement: "div",
            errorPlacement: function (error, element) {
                // Add the `help-block` class to the error element
                error.addClass("invalid-feedback");

                if (element.prop("type") === "checkbox") {
                    error.insertAfter(element.parent("label"));
                } else if (element.prop("type") === "radio") {
                    error.insertBefore(element.parent("label"));
                } else {
                    error.insertAfter(element);
                }
            },
        });
        $('#account-details').submit(function (e) {
            e.preventDefault();
            var form = $(this).serialize();
            $.post('php/updatePersonalInfo.php', form, function (data) {
                console.log(data);
                if (data == 1) {
                    $('#toast-title').html('Success');
                    $('#toast-body').html('Personal info succesfully updated.');
                    $('#notification-toast').toast('show');
                } else {
                    $('#toast-title').html('Failure');
                    $('#toast-body').html('Something wrong happened :c');
                    $('#notification-toast').toast('show');
                }
            })
        })
        $('#address-information').submit(function (e) {
            e.preventDefault();
            var form = $(this).serialize();
            $.post('php/updateAddress.php', form, function (data) {
                console.log(data);
                if (data == 1) {
                    $('#toast-title').html('Success');
                    $('#toast-body').html('Address succesfully updated.');
                    $('#notification-toast').toast('show');
                } else {
                    $('#toast-title').html('Failure');
                    $('#toast-body').html('Something wrong happened :c');
                    $('#notification-toast').toast('show');
                }
            })
        })
    </script>

</body>

</html>